<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[timbroder.com]]></title>
    <link href="https://www.timbroder.com/blog/tags/angularjs.xml" rel="self"/>
    <link href="https://www.timbroder.com/"/>
    <updated>2018-09-09T12:21:33+00:00</updated>
    <id>https://www.timbroder.com/</id>
            <author>
            <name><![CDATA[Tim Broder]]></name>            <email><![CDATA[timothy.broder@gmail.com]]></email>        </author>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[Poking at an AngularJS model from within an iFrame]]></title>
            <link href="https://www.timbroder.com/2014/05/poking-angularjs-model-within-iframe.html"/>
            <updated>2014-05-07T16:07:24+00:00</updated>
            <id>https://www.timbroder.com/2014/05/poking-angularjs-model-within-iframe.html</id>
            <content type="html"><![CDATA[<p>Full Disclosure: This is dirty and hacky. You may feel unclean after reading.
Grab soap.</p>

<p>For a few infrastructure reasons I won’t get into, we have an
iFrame on a page that Angular renders.  It pulls in a page that exists within
our code base and on the same site. Thankfully, no Cross Domain issues to
worry about.  The page within the iFrame needs some configuration from the
parent page. When a user is done in the iframe and hits a button inside of it,
the parent page needs some information from it.  This information has to be
updated in an Angular model on the parent page.</p>

<p>Starting off a partial
template:</p>

<pre><code data-language="HTML">&lt;iframe src="/....html" width="100%" height="800" scrolling="no" seamless="seamless" style="border:0;"&gt;&lt;/iframe&gt;
</code></pre>

<p>On the directive, I attach a configuration method to the window. Not great, I know.</p>

<pre><code data-language="javascript">link: function(scope, element, attrs) {

  top.window.TTTpassConfig = function() {
    config = {};
    config.RPCurl = attrs.initRpcurl;
    config.xml = attrs.initXml;
  }

},
</code></pre>

<p>This gets called from within the iFrame:</p>

<pre><code data-language="javascript">parent.passConfig()
</code></pre>

<p>At some point, the inner page is done, and needs to call back to the parent with data:</p>

<pre><code data-language="javascript">parent.callSave(outputXml);
</code></pre>

<p>But, this method needs to live in the partial template AND update the model. For simplicity, I went with inline JS and created the proper textarea to hold my data and bind to the model. Below I can see that the data is coming back, and the textarea has the text. There are two problems with this: 1) The model itself isn’t getting updated and 2) This js is outside of Angular’s scope so I can’t just call $apply. Angular’s dirty checking won’t see this change. I needed a way to update the model from outside Angular.</p>

<pre><code data-language="HTML">
&lt;script type="text/javascript"&gt;
    function callSave(payload){
        console.log('Data being saved from iframe: ', payload);
        var $elm = $('#iframe-data');
        $elm.val(payload);
    }
&lt;/script&gt;

&lt;iframe src="/....html" width="100%" height="800" scrolling="no" seamless="seamless" style="border:0;"&gt;&lt;/iframe&gt;
&lt;pre&gt;{{parent[uuid][data.id].value}}&lt;/pre&gt;
&lt;textarea type="text" id="iframe-data" ng-model="parent[uuid][data.id].value" data-name="{{data.name}}" data-id="{{data.id}}" value="{{data.value}}"&gt;&lt;/textarea&gt;

</code></pre>

<p>The trick ended up being that ngModel listens for an “input” event. Use that, hide the textarea, and I’m good to go</p>

<pre><code data-language="HTML">
&lt;script type="text/javascript"&gt;
    function callSave(payload){
        console.log('Data being saved from iframe: ', payload);
        var $elm = $('#iframe-data');
        $elm.val(payload);
        $elm.trigger('input');
    }
&lt;/script&gt;

&lt;iframe src="/....html" width="100%" height="800" scrolling="no" seamless="seamless" style="border:0;"&gt;&lt;/iframe&gt;
&lt;pre&gt;{{parent[uuid][data.id].value}}&lt;/pre&gt;
&lt;textarea type="text" id="iframe-data" ng-model="parent[uuid][data.id].value" data-name="{{data.name}}" data-id="{{data.id}}" value="{{data.value}}" style="display: none;"&gt;&lt;/textarea&gt;

</code></pre>

<p>I know the Angular way to do this would have been a combination of $watch and $apply from within the directive. I went down that road for a few hours. Because of timeline constraints I have to leave as is. I’ve acknowledged that I’m incurring technical debt and marked a TODO that may or may never get addressed.</p>
]]></content>
        </entry>
    </feed>